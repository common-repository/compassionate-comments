!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=15)}([function(e,t){!function(){e.exports=this.wp.element}()},function(e,t){!function(){e.exports=this.wp.i18n}()},function(e,t){!function(){e.exports=this.wp.components}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var o=n(1);function r(e){console.error(Object(o.__)("Compassionate Comments error:","compassionate-comments"),e)}},function(e,t,n){var o=n(13);e.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,n){var o=n(11);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var o=n(12),r=n(5);e.exports=function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?r(e):t}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}e.exports=function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(t,o){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,o)}e.exports=n},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=o=function(e){return n(e)}:e.exports=o=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},o(t)}e.exports=o},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},,function(e,t,n){"use strict";n.r(t);var o=n(4),r=n.n(o),c=n(0),i=n(1),a=n(10),s=n.n(a),u=n(9),m=n.n(u),l=n(8),p=n.n(l),f=n(7),y=n.n(f),b=n(5),d=n.n(b),h=n(6),v=n.n(h),O=n(2);function j(e){var t=e.handleSubmitAnyway,n=e.handleRephraseComment;return Object(c.createElement)("div",{id:"comcon-front-end__nudge"},Object(c.createElement)("p",null,Object(i.__)("It looks like your comment is likely to be interpreted as rude or disrespectful.","compassionate-comments")),Object(c.createElement)("p",null,Object(c.createElement)(c.RawHTML,null,Object(i.sprintf)("Please remember that there's another human being on the other end of this conversation, and they'll be impacted by the words that you write. It's also worth considering that you may have <a href=\"%s\">misinterpreted their intentions</a>. Please consider rephrasing your comment to be more kind.","https://www.edutopia.org/blog/assuming-positive-intent-laura-thomas"))),Object(c.createElement)(O.Button,{isPrimary:!0,name:"cc_rephrase_comment",onClick:n},Object(i.__)("Edit Comment","compassionate-comments")),Object(c.createElement)(O.Button,{isDefault:!0,isDestructive:!0,isLink:!0,name:"cc_submit_anyway",onClick:t},Object(i.__)("Submit Anyway","compassionate-comments")))}function g(e){var t,n=e.interfaceOpen,o=e.loading,r=e.isToxic,a=e.handleModalClose,s=e.handleRephraseComment,u=e.handleSubmitAnyway,m=["comcon-front-end"];return n?(o?(m.push("is-loading"),t=Object(i.__)("Analyzing comment...","compassionate-comments")):r&&(t=Object(i.__)("Please rephrase your comment.","compassionate-comments")),Object(c.createElement)(O.Modal,{className:m,title:t,onRequestClose:a,isDismissable:!0},o&&Object(c.createElement)(O.Spinner,null),r&&Object(c.createElement)(j,{handleSubmitAnyway:u,handleRephraseComment:s}))):null}var S=n(3),_=function(e){function t(e){var n;return s()(this,t),(n=p()(this,y()(t).call(this,e))).defaultState={error:!1,interfaceOpen:!1,loading:!1,isToxic:!1},n.state=n.defaultState,n.analyzeComment=n.analyzeComment.bind(d()(n)),e.commentForm.addEventListener("submit",n.analyzeComment),n}return v()(t,e),m()(t,[{key:"analyzeComment",value:function(e){var t=this;try{document.getElementById("comment").value}catch(e){return void Object(S.a)(e)}e.preventDefault(),this.setState({interfaceOpen:!0,loading:!0},function(){var e=t.props.perspectiveSensitivity,n=document.getElementById("comment").value,o={};t.sendScoreRequest(n).then(function(n){try{var r=n.attributeScores.TOXICITY.summaryScore.value;o={isToxic:r>e/100},t.logScore(r)}catch(e){o={error:e}}}).catch(function(e){o={error:e}}).finally(function(){o.error&&Object(S.a)(o.error);var e=o.error||!o.isToxic;o.loading=!1,o.interfaceOpen=!e,t.setState(o,function(){e&&t.submitComment()})})})}},{key:"sendScoreRequest",value:function(e){var t=this.props.perspectiveApiKey,n={comment:{text:e},requestedAttributes:{TOXICITY:{}}},o="https://commentanalyzer.googleapis.com/v1alpha1/comments:analyze?key=".concat(t);n.doNotStore=this.doNotStore();var r={method:"POST",body:JSON.stringify(n),headers:new Headers({"Content-Type":"application/json"}),credentials:"omit"};return fetch(o,r).then(function(e){return e.json()})}},{key:"doNotStore",value:function(){var e=this.props,t=e.isTestEnvironment,n=e.postIsPublic,o=e.siteIsPublic,r=e.perspectiveStoreComments,c=!r;return r&&(!t&&o&&n||(c=!0)),c}},{key:"logScore",value:function(e){var t=this.props.commentForm,n=document.createElement("input"),o="comcon_perspective_score_".concat(Date.now());n.name="comcon_comment_meta[".concat(o,"]"),n.type="hidden",n.value=e,t.appendChild(n)}},{key:"submitComment",value:function(e){try{document.createElement("form").submit.call(document.getElementById("commentform"))}catch(e){Object(S.a)(e)}}},{key:"render",value:function(){var e=this,t=this.state,n=t.error,o=t.interfaceOpen,i=t.isToxic,a=t.loading;return!o||n?null:Object(c.createElement)(g,{handleSubmitAnyway:this.submitComment,handleRephraseComment:function(){return e.setState(r()({},e.defaultState))},handleModalClose:function(){return e.setState(r()({},e.defaultState))},interfaceOpen:o,loading:a,isToxic:i})}}]),t}(c.Component);!function(){!function(){var e=document.createElement("div"),t=document.getElementById("commentform"),n=r()({commentForm:t},comconOptions);t&&(n.perspectiveApiKey?(document.getElementsByTagName("body")[0].appendChild(e),function(e,t){Object(c.render)(Object(c.createElement)(_,t),e)}(e,n)):Object(S.a)(Object(i.__)("Missing key for Perspective API. Please visit the settings screen to enter it.","compassionate-comments")))}()}()}]);